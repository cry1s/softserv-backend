version: "3"
volumes:
  postgresdb-data:
services:
  server:
      build:
        context: .
        target: final
      ports:
        - 8080:8080
      depends_on:
        - db
      environment:
        - DATABASE_URL=${DATABASE_URL} # here it is!
  db:
    image: postgres:latest
    env_file:
      - .env
    volumes:
      - type: volume
        source: postgresdb-data
        target: /var/lib/postgresql/data
  adminer:
    image: adminer:latest
    ports:
      - "5000:8080"
    depends_on:
      - db